<!DOCTYPE html>
<html lang="en" class="light">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>EventEase - Your Countdown Companion</title>
Â  Â  Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  Â  Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
Â  Â  Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
Â  Â  Â  Â  <script src="https://accounts.google.com/gsi/client" async></script>
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s ease, color 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* New Light Mode Colors - Fresh & Inviting (Blue/Cyan) */
Â  Â  Â  Â  .light {
Â  Â  Â  Â  Â  Â  --bg-color: #e0f2f7; /* Very light cyan */
Â  Â  Â  Â  Â  Â  --card-bg: #ffffff; /* Pure white */
Â  Â  Â  Â  Â  Â  --text-color: #263238; /* Dark blue-gray */
Â  Â  Â  Â  Â  Â  --accent-color: #00bcd4; /* Deep Sky Blue (Cyan 500) */
Â  Â  Â  Â  Â  Â  --shadow-color: rgba(0, 0, 0, 0.08);
Â  Â  Â  Â  Â  Â  --border-color: #cfd8dc; /* Light blue-gray */
Â  Â  Â  Â  }
Â  Â  Â  Â  /* New Dark Mode Colors - Deep & Rich (Blue/Cyan) */
Â  Â  Â  Â  .dark {
Â  Â  Â  Â  Â  Â  --bg-color: #263238; /* Dark blue-gray */
Â  Â  Â  Â  Â  Â  --card-bg: #37474f; /* Slightly lighter dark blue-gray */
Â  Â  Â  Â  Â  Â  --text-color: #eceff1; /* Light blue-gray */
Â  Â  Â  Â  Â  Â  --accent-color: #4dd0e1; /* Lighter Cyan (Cyan 300) */
Â  Â  Â  Â  Â  Â  --shadow-color: rgba(0, 0, 0, 0.4);
Â  Â  Â  Â  Â  Â  --border-color: #546e7a; /* Medium dark blue-gray */
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  .card {
Â  Â  Â  Â  Â  Â  background-color: var(--card-bg);
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 12px var(--shadow-color);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-primary {
Â  Â  Â  Â  Â  Â  background-color: var(--accent-color);
Â  Â  Â  Â  Â  Â  color: var(--card-bg); /* Use card-bg for text on primary buttons */
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-secondary {
Â  Â  Â  Â  Â  Â  background-color: var(--border-color);
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-content {
Â  Â  Â  Â  Â  Â  background-color: var(--card-bg);
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 25px var(--shadow-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  input, select, textarea {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  input:focus, select:focus, textarea:focus {
Â  Â  Â  Â  Â  Â  border-color: var(--accent-color);
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Progress Bar Styling */
Â  Â  Â  Â  .progress-bar-container {
Â  Â  Â  Â  Â  Â  background-color: var(--border-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  .progress-bar-fill {
Â  Â  Â  Â  Â  Â  background-color: var(--accent-color);
Â  Â  Â  Â  Â  Â  transition: width 0.5s ease-out;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Confetti Animation */
Â  Â  Â  Â  .confetti-container {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  z-index: 9999;
Â  Â  Â  Â  }
Â  Â  Â  Â  .confetti {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  width: 10px;
Â  Â  Â  Â  Â  Â  height: 10px;
Â  Â  Â  Â  Â  Â  background-color: #f00; /* Default color, overridden by JS */
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  animation: confetti-fall 3s forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes confetti-fall {
Â  Â  Â  Â  Â  Â  0% {
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(-100vh) rotate(0deg);
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  10% {
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  100% {
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(100vh) rotate(720deg);
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Animation for countdown numbers change */
Â  Â  Â  Â  @keyframes pulse-once {
Â  Â  Â  Â  Â  Â  0% { transform: scale(1); opacity: 1; }
Â  Â  Â  Â  Â  Â  50% { transform: scale(1.1); opacity: 0.8; }
Â  Â  Â  Â  Â  Â  100% { transform: scale(1); opacity: 1; }
Â  Â  Â  Â  }
Â  Â  Â  Â  .animate-pulse-once {
Â  Â  Â  Â  Â  Â  animation: pulse-once 0.3s ease-in-out;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Header Gradient Animation */
Â  Â  Â  Â  .animated-header-gradient {
Â  Â  Â  Â  Â  Â  background-size: 200% 200%;
Â  Â  Â  Â  Â  Â  animation: gradient-shift 10s ease infinite;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes gradient-shift {
Â  Â  Â  Â  Â  Â  0% { background-position: 0% 50%; }
Â  Â  Â  Â  Â  Â  50% { background-position: 100% 50%; }
Â  Â  Â  Â  Â  Â  100% { background-position: 0% 50%; }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* New Animations */
Â  Â  Â  Â  @keyframes fade-in-up {
Â  Â  Â  Â  Â  Â  from {
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(20px);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  to {
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  .animate-fade-in-up {
Â  Â  Â  Â  Â  Â  animation: fade-in-up 0.5s ease-out forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes subtle-pulse {
Â  Â  Â  Â  Â  Â  0% { transform: scale(1); }
Â  Â  Â  Â  Â  Â  50% { transform: scale(1.03); }
Â  Â  Â  Â  Â  Â  100% { transform: scale(1); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .animate-subtle-pulse {
Â  Â  Â  Â  Â  Â  animation: subtle-pulse 2.5s infinite ease-in-out;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="min-h-screen flex flex-col">

Â  Â  Â  Â  <header class="bg-gradient-to-r from-cyan-500 to-blue-600 text-white p-4 shadow-lg animated-header-gradient">
Â  Â  Â  Â  <div class="container mx-auto flex justify-between items-center">
Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold">EventEase ğŸ—“ï¸</h1>
Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="theme-toggle" class="p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-sun text-xl dark:hidden"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-moon text-xl hidden dark:inline-block"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="settings-btn" class="p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-cog text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="google-signin-btn" class="ml-4"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="user-profile" class="hidden items-center space-x-3 ml-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="user-avatar" class="w-8 h-8 rounded-full" alt="User Avatar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="signout-btn" class="p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-sign-out-alt text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  Â  Â  <main class="flex-grow container mx-auto p-4 md:p-8">
Â  Â  Â  Â  Â  Â  Â  Â  <section id="home-section" class="text-center py-16 px-4">
Â  Â  Â  Â  Â  Â  <h2 class="text-4xl md:text-5xl font-extrabold mb-6 leading-tight">
Â  Â  Â  Â  Â  Â  Â  Â  Never Miss a Moment. <br>Your Life, Counted Down.
Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto opacity-80">
Â  Â  Â  Â  Â  Â  Â  Â  EventEase helps you create, track, and celebrate every important milestone. From birthdays to big projects, keep every moment in sight.
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <button id="create-first-countdown-btn" class="btn-primary px-8 py-4 rounded-full text-lg font-semibold shadow-xl hover:scale-105 transition-transform duration-300 animate-subtle-pulse">
Â  Â  Â  Â  Â  Â  Â  Â  Create Your First Countdown <i class="fas fa-plus ml-2"></i>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  Â  Â  <section id="my-countdowns-section" class="hidden py-8">
Â  Â  Â  Â  Â  Â  <div class="flex flex-col md:flex-row justify-between items-center mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4 md:mb-0">My Countdowns</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="sort-by" class="text-sm">Sort by:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="sort-by" class="p-2 rounded-md border text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="date-asc">Date (Soonest First)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="date-desc">Date (Latest First)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="title-asc">Title (A-Z)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="title-desc">Title (Z-A)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="countdown-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p id="no-events-message" class="text-center text-lg mt-10 hidden opacity-70">
Â  Â  Â  Â  Â  Â  Â  Â  No countdowns yet! Click the '+' button to add your first event.
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  </section>
Â  Â  </main>

Â  Â  Â  Â  <button id="add-event-fab" class="fixed bottom-6 right-6 bg-cyan-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-3xl shadow-xl hover:bg-cyan-700 transition-colors duration-300 z-40">
Â  Â  Â  Â  <i class="fas fa-plus"></i>
Â  Â  </button>

Â  Â  Â  Â  Â  Â  <div id="add-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
Â  Â  Â  Â  <div class="modal-content rounded-xl p-6 w-full max-w-md transform transition-all duration-300 -translate-y-10 opacity-0">
Â  Â  Â  Â  Â  Â  <h3 id="modal-title" class="text-2xl font-bold mb-6 text-center">Add New Event</h3>
Â  Â  Â  Â  Â  Â  <form id="event-form" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="event-title" class="block text-sm font-medium mb-1">Event Title</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="event-title" placeholder="e.g., My Birthday, Exam Day" required
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="w-full p-3 rounded-lg focus:ring-2 focus:ring-accent-color transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="event-date" class="block text-sm font-medium mb-1">Date & Time</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="datetime-local" id="event-date" required
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="w-full p-3 rounded-lg focus:ring-2 focus:ring-accent-color transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="event-icon" class="block text-sm font-medium mb-1">Icon/Emoji (Optional)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="event-icon" placeholder="e.g., ğŸ‚, ğŸ“, âœˆï¸" maxlength="2"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="flex-grow p-3 rounded-lg focus:ring-2 focus:ring-accent-color transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" id="open-emoji-picker" class="p-3 rounded-lg btn-secondary">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="far fa-smile"></i> Pick
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="event-recurring" class="mr-2 h-4 w-4 text-accent-color rounded focus:ring-accent-color">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="event-recurring" class="text-sm font-medium">Repeat Annually (Birthday/Anniversary)</label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end space-x-3 mt-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" id="cancel-add-edit" class="btn-secondary px-5 py-2 rounded-lg font-medium hover:opacity-80 transition-opacity">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn-primary px-5 py-2 rounded-lg font-medium shadow-md hover:opacity-90 transition-opacity">Save Event</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
Â  Â  Â  Â  <div class="modal-content rounded-xl p-6 w-full max-w-md transform transition-all duration-300 -translate-y-10 opacity-0">
Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-6 text-center">Settings</h3>
Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center py-2 border-b border-border-color">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-medium">Dark Mode</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="settings-theme-toggle" class="sr-only peer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent-color dark:peer-focus:ring-accent-color rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-cyan-600"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="py-2 border-b border-border-color">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-medium block mb-2">Data Management</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="export-data-btn" class="btn-secondary w-full px-4 py-2 rounded-lg font-medium hover:opacity-80 transition-opacity">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Export Countdowns <i class="fas fa-download ml-2"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="import-file-input" class="btn-secondary w-full px-4 py-2 rounded-lg font-medium cursor-pointer text-center hover:opacity-80 transition-opacity">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Import Countdowns <i class="fas fa-upload ml-2"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="import-file-input" accept=".json" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="clear-all-data-btn" class="bg-red-500 text-white w-full px-4 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Clear All Countdowns <i class="fas fa-trash-alt ml-2"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex justify-end mt-6">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" id="close-settings" class="btn-secondary px-5 py-2 rounded-lg font-medium hover:opacity-80 transition-opacity">Close</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="emoji-picker-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
Â  Â  Â  Â  <div class="modal-content rounded-xl p-6 w-full max-w-md transform transition-all duration-300 -translate-y-10 opacity-0">
Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-4 text-center">Pick an Emoji</h3>
Â  Â  Â  Â  Â  Â  <div id="emoji-grid" class="grid grid-cols-6 gap-2 text-3xl text-center max-h-64 overflow-y-auto p-2 rounded-lg border border-border-color">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex justify-end mt-6">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" id="close-emoji-picker-modal" class="btn-secondary px-5 py-2 rounded-lg font-medium hover:opacity-80 transition-opacity">Close</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="message-box-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
Â  Â  Â  Â  <div class="modal-content rounded-xl p-6 w-full max-w-sm text-center transform transition-all duration-300 -translate-y-10 opacity-0">
Â  Â  Â  Â  Â  Â  <p id="message-box-text" class="text-lg mb-6"></p>
Â  Â  Â  Â  Â  Â  <div class="flex justify-center space-x-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="message-box-cancel" class="btn-secondary px-5 py-2 rounded-lg font-medium hover:opacity-80 transition-opacity hidden">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="message-box-ok" class="btn-primary px-5 py-2 rounded-lg font-medium shadow-md hover:opacity-90 transition-opacity">OK</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="confetti-container" class="confetti-container hidden"></div>

Â  Â  <script>
Â  Â  Â  Â  // Global variables for events and current edit state
Â  Â  Â  Â  let events = [];
Â  Â  Â  Â  let currentEditingEventId = null;
Â  Â  Â  Â  let countdownInterval;

Â  Â  Â  Â  // DOM Element References
Â  Â  Â  Â  const htmlElement = document.documentElement;
Â  Â  Â  Â  const homeSection = document.getElementById('home-section');
Â  Â  Â  Â  const myCountdownsSection = document.getElementById('my-countdowns-section');
Â  Â  Â  Â  const countdownGrid = document.getElementById('countdown-grid');
Â  Â  Â  Â  const noEventsMessage = document.getElementById('no-events-message');

Â  Â  Â  Â  // Modals
Â  Â  Â  Â  const addEditModal = document.getElementById('add-edit-modal');
Â  Â  Â  Â  const settingsModal = document.getElementById('settings-modal');
Â  Â  Â  Â  const emojiPickerModal = document.getElementById('emoji-picker-modal');
Â  Â  Â  Â  const messageBoxModal = document.getElementById('message-box-modal');

Â  Â  Â  Â  // Form Elements
Â  Â  Â  Â  const eventForm = document.getElementById('event-form');
Â  Â  Â  Â  const eventTitleInput = document.getElementById('event-title');
Â  Â  Â  Â  const eventDateInput = document.getElementById('event-date');
Â  Â  Â  Â  const eventIconInput = document.getElementById('event-icon');
Â  Â  Â  Â  const eventRecurringCheckbox = document.getElementById('event-recurring');
Â  Â  Â  Â  const modalTitle = document.getElementById('modal-title');

Â  Â  Â  Â  // Buttons
Â  Â  Â  Â  const themeToggleBtn = document.getElementById('theme-toggle');
Â  Â  Â  Â  const settingsBtn = document.getElementById('settings-btn');
Â  Â  Â  Â  const createFirstCountdownBtn = document.getElementById('create-first-countdown-btn');
Â  Â  Â  Â  const addEventFab = document.getElementById('add-event-fab');
Â  Â  Â  Â  const cancelAddEditBtn = document.getElementById('cancel-add-edit');
Â  Â  Â  Â  const closeSettingsBtn = document.getElementById('close-settings');
Â  Â  Â  Â  const openEmojiPickerBtn = document.getElementById('open-emoji-picker');
Â  Â  Â  Â  const closeEmojiPickerModalBtn = document.getElementById('close-emoji-picker-modal');
Â  Â  Â  Â  const exportDataBtn = document.getElementById('export-data-btn');
Â  Â  Â  Â  const importFileInput = document.getElementById('import-file-input');
Â  Â  Â  Â  const clearAllDataBtn = document.getElementById('clear-all-data-btn');
Â  Â  Â  Â  const settingsThemeToggle = document.getElementById('settings-theme-toggle');
Â  Â  Â  Â  const sortBySelect = document.getElementById('sort-by');
Â  Â  Â  Â  const googleSignInBtn = document.getElementById('google-signin-btn');
Â  Â  Â  Â  const userProfileDiv = document.getElementById('user-profile');
Â  Â  Â  Â  const userAvatarImg = document.getElementById('user-avatar');
Â  Â  Â  Â  const signOutBtn = document.getElementById('signout-btn');

Â  Â  Â  Â  // Emoji Grid
Â  Â  Â  Â  const emojiGrid = document.getElementById('emoji-grid');
Â  Â  Â  Â  const commonEmojis = ['ğŸ‰', 'ğŸ‚', 'ğŸ“', 'âœˆï¸', 'ğŸ–ï¸', 'ğŸ„', 'ğŸƒ', 'ğŸ', 'ğŸ’', 'â¤ï¸', 'ğŸ’¼', 'ğŸ’ª', 'ğŸ—“ï¸', 'ğŸ¥³', 'âœ¨', 'ğŸ“š', 'ğŸµ', 'ğŸ®', 'ğŸ¡', 'ğŸš—'];

Â  Â  Â  Â  // Confetti
Â  Â  Â  Â  const confettiContainer = document.getElementById('confetti-container');

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Initializes the application.
Â  Â  Â  Â  Â * Loads events, sets up theme, renders countdowns, and attaches event listeners.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function initApp() {
Â  Â  Â  Â  Â  Â  loadEvents();
Â  Â  Â  Â  Â  Â  setInitialTheme();
Â  Â  Â  Â  Â  Â  initializeGoogleSignIn();
Â  Â  Â  Â  Â  Â  renderCountdowns();
Â  Â  Â  Â  Â  Â  startCountdownUpdater();
Â  Â  Â  Â  Â  Â  attachEventListeners();
Â  Â  Â  Â  Â  Â  showInitialSection();
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Shows either the home section or the countdowns section based on existing events.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function showInitialSection() {
Â  Â  Â  Â  Â  Â  if (events.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  homeSection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  myCountdownsSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  homeSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  myCountdownsSection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Loads events from localStorage.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function loadEvents() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const storedEvents = localStorage.getItem('eventEaseEvents');
Â  Â  Â  Â  Â  Â  Â  Â  events = storedEvents ? JSON.parse(storedEvents) : [];
Â  Â  Â  Â  Â  Â  Â  Â  // Ensure targetDate is a valid ISO string and handle recurring events
Â  Â  Â  Â  Â  Â  Â  Â  events = events.map(event => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event.isRecurring) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let targetDate = new Date(event.targetDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let now = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // If recurring event date has passed this year, set for next year
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Only update if the targetDate is actually in the past
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (targetDate.getTime() <= now.getTime()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetDate.setFullYear(now.getFullYear() + 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  event.targetDate = targetDate.toISOString().slice(0, 16); // Store as YYYY-MM-DDTHH:MM
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return event;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  sortEvents(); // Sort after loading and adjusting recurring dates
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Failed to load events from localStorage:", e);
Â  Â  Â  Â  Â  Â  Â  Â  events = [];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Saves events to localStorage.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function saveEvents() {
Â  Â  Â  Â  Â  Â  localStorage.setItem('eventEaseEvents', JSON.stringify(events));
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Sorts the events array based on the selected sort option.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function sortEvents() {
Â  Â  Â  Â  Â  Â  const sortBy = sortBySelect.value;
Â  Â  Â  Â  Â  Â  switch (sortBy) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'date-asc':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  events.sort((a, b) => new Date(a.targetDate).getTime() - new Date(b.targetDate).getTime());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'date-desc':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  events.sort((a, b) => new Date(b.targetDate).getTime() - new Date(a.targetDate).getTime());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'title-asc':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  events.sort((a, b) => a.title.localeCompare(b.title));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'title-desc':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  events.sort((a, b) => b.title.localeCompare(a.title));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  saveEvents(); // Save sorted order
Â  Â  Â  Â  Â  Â  renderCountdowns(); // Re-render to reflect sort
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Renders all countdown cards.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function renderCountdowns() {
Â  Â  Â  Â  Â  Â  countdownGrid.innerHTML = ''; // Clear existing cards
Â  Â  Â  Â  Â  Â  if (events.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  noEventsMessage.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  homeSection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  myCountdownsSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  noEventsMessage.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  homeSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  myCountdownsSection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  events.forEach((event, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const card = createCountdownCard(event);
Â  Â  Â  Â  Â  Â  Â  Â  // Add staggered animation
Â  Â  Â  Â  Â  Â  Â  Â  card.style.animationDelay = `${index * 100}ms`;
Â  Â  Â  Â  Â  Â  Â  Â  card.classList.add('animate-fade-in-up');
Â  Â  Â  Â  Â  Â  Â  Â  countdownGrid.appendChild(card);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Creates a single countdown card element.
Â  Â  Â  Â  Â * @param {object} event - The event object.
Â  Â  Â  Â  Â * @returns {HTMLElement} The created card element.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function createCountdownCard(event) {
Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  // Added min-w-[300px] to ensure cards have enough space
Â  Â  Â  Â  Â  Â  card.id = `event-card-${event.id}`;
Â  Â  Â  Â  Â  Â  card.className = 'card rounded-xl p-6 flex flex-col justify-between transform hover:scale-102 transition-transform duration-200 min-w-[300px]';

Â  Â  Â  Â  Â  Â  const targetDate = new Date(event.targetDate);
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  const isExpired = targetDate.getTime() <= now.getTime();

Â  Â  Â  Â  Â  Â  // Check for confetti trigger for recurring events
Â  Â  Â  Â  Â  Â  if (event.isRecurring && !isExpired) {
Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  // Only trigger if the month and day match, and it hasn't passed for today
Â  Â  Â  Â  Â  Â  Â  Â  if (targetDate.getMonth() === today.getMonth() && targetDate.getDate() === today.getDate() && targetDate.getTime() > now.getTime()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  triggerConfetti();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-4xl mr-3">${event.icon || 'ğŸ—“ï¸'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold flex-grow ${isExpired ? 'line-through opacity-70' : ''}">${event.title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="countdown-display text-center my-4 ${isExpired ? 'opacity-50' : ''}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center items-baseline space-x-3 md:space-x-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-unit flex-shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl md:text-5xl font-extrabold text-accent-color" data-unit="days"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs uppercase tracking-wider opacity-80">Days</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-4xl md:text-5xl text-accent-color flex-shrink-0">:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-unit flex-shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl md:text-5xl font-extrabold text-accent-color" data-unit="hours"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs uppercase tracking-wider opacity-80">Hours</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-4xl md:text-5xl text-accent-color flex-shrink-0">:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-unit flex-shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl md:text-5xl font-extrabold text-accent-color" data-unit="minutes"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-4xl md:text-5xl text-accent-color flex-shrink-0">:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-unit flex-shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl md:text-5xl font-extrabold text-accent-color" data-unit="seconds"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-container w-full h-2 rounded-full overflow-hidden mb-4 ${isExpired ? 'opacity-50' : ''}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-fill h-full rounded-full" style="width: 0%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end space-x-2 mt-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isExpired ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-secondary px-3 py-1 rounded-md text-sm delete-btn" data-id="${event.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trash-alt"></i> Delete
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-secondary px-3 py-1 rounded-md text-sm edit-btn" data-id="${event.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-edit"></i> Edit
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-secondary px-3 py-1 rounded-md text-sm delete-btn" data-id="${event.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trash-alt"></i> Delete
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  // Update countdown display immediately
Â  Â  Â  Â  Â  Â  updateCountdownDisplay(card, event.targetDate);

Â  Â  Â  Â  Â  Â  // Add event listeners for edit and delete buttons
Â  Â  Â  Â  Â  Â  card.querySelector('.edit-btn')?.addEventListener('click', () => openAddEditModal(event));
Â  Â  Â  Â  Â  Â  card.querySelector('.delete-btn')?.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Are you sure you want to delete this event?', 'confirm', () => deleteEvent(event.id));
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  return card;
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Updates the countdown display for a single card.
Â  Â  Â  Â  Â * @param {HTMLElement} cardElement - The card element to update.
Â  Â  Â  Â  Â * @param {string} targetDateStr - The target date string (ISO format).
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function updateCountdownDisplay(cardElement, targetDateStr) {
Â  Â  Â  Â  Â  Â  const targetDate = new Date(targetDateStr);
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  let diff = targetDate.getTime() - now.getTime();

Â  Â  Â  Â  Â  Â  const daysEl = cardElement.querySelector('[data-unit="days"]');
Â  Â  Â  Â  Â  Â  const hoursEl = cardElement.querySelector('[data-unit="hours"]');
Â  Â  Â  Â  Â  Â  const minutesEl = cardElement.querySelector('[data-unit="minutes"]');
Â  Â  Â  Â  Â  Â  const secondsEl = cardElement.querySelector('[data-unit="seconds"]');
Â  Â  Â  Â  Â  Â  const progressBarFill = cardElement.querySelector('.progress-bar-fill');

Â  Â  Â  Â  Â  Â  // Function to pad single digits with a leading zero
Â  Â  Â  Â  Â  Â  const pad = (num) => num < 10 ? '0' + num : num;

Â  Â  Â  Â  Â  Â  // Add a subtle animation class when numbers change
Â  Â  Â  Â  Â  Â  const animateChange = (element, newValue) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (element && element.textContent !== newValue) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  element.classList.add('animate-pulse-once');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  element.textContent = newValue;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  element.addEventListener('animationend', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  element.classList.remove('animate-pulse-once');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, { once: true });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  if (diff <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  // Event has passed
Â  Â  Â  Â  Â  Â  Â  Â  if (daysEl) daysEl.textContent = '00';
Â  Â  Â  Â  Â  Â  Â  Â  if (hoursEl) hoursEl.textContent = '00';
Â  Â  Â  Â  Â  Â  Â  Â  if (minutesEl) minutesEl.textContent = '00';
Â  Â  Â  Â  Â  Â  Â  Â  if (secondsEl) secondsEl.textContent = '00';

Â  Â  Â  Â  Â  Â  Â  Â  // Display "Event Passed!" in the main time left element if it exists (for simpler cards)
Â  Â  Â  Â  Â  Â  Â  Â  const timeLeftDisplay = cardElement.querySelector('[data-time-left]');
Â  Â  Â  Â  Â  Â  Â  Â  if (timeLeftDisplay) timeLeftDisplay.textContent = "Event Passed!";
Â  Â  Â  Â  Â  Â  Â  Â  const timeLabelsDisplay = cardElement.querySelector('[data-time-labels]');
Â  Â  Â  Â  Â  Â  Â  Â  if (timeLabelsDisplay) timeLabelsDisplay.textContent = "";

Â  Â  Â  Â  Â  Â  Â  Â  if (progressBarFill) progressBarFill.style.width = '100%';
Â  Â  Â  Â  Â  Â  Â  Â  cardElement.classList.add('opacity-70', 'grayscale'); // Visually dim expired events
Â  Â  Â  Â  Â  Â  Â  Â  cardElement.querySelectorAll('.edit-btn').forEach(btn => btn.classList.add('hidden')); // Hide edit button
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  cardElement.classList.remove('opacity-70', 'grayscale');
Â  Â  Â  Â  Â  Â  Â  Â  cardElement.querySelectorAll('.edit-btn').forEach(btn => btn.classList.remove('hidden'));
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  diff -= days * (1000 * 60 * 60 * 24);
Â  Â  Â  Â  Â  Â  const hours = Math.floor(diff / (1000 * 60 * 60));
Â  Â  Â  Â  Â  Â  diff -= hours * (1000 * 60 * 60);
Â  Â  Â  Â  Â  Â  const minutes = Math.floor(diff / (1000 * 60));
Â  Â  Â  Â  Â  Â  diff -= minutes * (1000 * 60);
Â  Â  Â  Â  Â  Â  const seconds = Math.floor(diff / 1000);

Â  Â  Â  Â  Â  Â  animateChange(daysEl, pad(days));
Â  Â  Â  Â  Â  Â  animateChange(hoursEl, pad(hours));
Â  Â  Â  Â  Â  Â  animateChange(minutesEl, pad(minutes));
Â  Â  Â  Â  Â  Â  animateChange(secondsEl, pad(seconds));

Â  Â  Â  Â  Â  Â  // Update progress bar
Â  Â  Â  Â  Â  Â  // To calculate progress accurately, we need the event's creation time.
Â  Â  Â  Â  Â  Â  // For simplicity, let's assume events are created *now* for progress calculation
Â  Â  Â  Â  Â  Â  // or store a 'creationTime' property with each event.
Â  Â  Â  Â  Â  Â  // For now, let's just show progress based on the current year for recurring, or total time for one-off.
Â  Â  Â  Â  Â  Â  // This needs a more robust 'creationTime' property on the event object for true accuracy.
Â  Â  Â  Â  Â  Â  // For demonstration, we'll use a simplified progress that fills over the remaining time.
Â  Â  Â  Â  Â  Â  const totalRemaining = targetDate.getTime() - now.getTime();
Â  Â  Â  Â  Â  Â  const initialRemaining = events.find(e => e.id === cardElement.id.replace('event-card-', ''))?.initialRemaining || totalRemaining; // Placeholder
Â  Â  Â  Â  Â  Â  let progress = ((initialRemaining - totalRemaining) / initialRemaining) * 100;

Â  Â  Â  Â  Â  Â  if (progress < 0 || isNaN(progress)) progress = 0;
Â  Â  Â  Â  Â  Â  if (progress > 100) progress = 100;
Â  Â  Â  Â  Â  Â  if (progressBarFill) progressBarFill.style.width = `${progress}%`;
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Starts the interval to update all countdowns every second.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function startCountdownUpdater() {
Â  Â  Â  Â  Â  Â  if (countdownInterval) clearInterval(countdownInterval); // Clear any existing interval
Â  Â  Â  Â  Â  Â  countdownInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.card').forEach(cardElement => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventId = cardElement.id.replace('event-card-', '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const event = events.find(e => e.id === eventId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateCountdownDisplay(cardElement, event.targetDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Opens the add/edit event modal.
Â  Â  Â  Â  Â * @param {object} [event=null] - The event object to pre-fill the form for editing.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function openAddEditModal(event = null) {
Â  Â  Â  Â  Â  Â  openModal(addEditModal); // Use helper function for consistent modal opening

Â  Â  Â  Â  Â  Â  if (event) {
Â  Â  Â  Â  Â  Â  Â  Â  modalTitle.textContent = 'Edit Event';
Â  Â  Â  Â  Â  Â  Â  Â  eventTitleInput.value = event.title;
Â  Â  Â  Â  Â  Â  Â  Â  // Format date for datetime-local input (YYYY-MM-DDTHH:MM)
Â  Â  Â  Â  Â  Â  Â  Â  eventDateInput.value = event.targetDate.slice(0, 16);
Â  Â  Â  Â  Â  Â  Â  Â  eventIconInput.value = event.icon || '';
Â  Â  Â  Â  Â  Â  Â  Â  eventRecurringCheckbox.checked = event.isRecurring || false;
Â  Â  Â  Â  Â  Â  Â  Â  currentEditingEventId = event.id;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  modalTitle.textContent = 'Add New Event';
Â  Â  Â  Â  Â  Â  Â  Â  eventForm.reset(); // Clear form for new event
Â  Â  Â  Â  Â  Â  Â  Â  // Default to tomorrow's date and time for new events
Â  Â  Â  Â  Â  Â  Â  Â  const tomorrow = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  tomorrow.setDate(tomorrow.getDate() + 1);
Â  Â  Â  Â  Â  Â  Â  Â  tomorrow.setHours(tomorrow.getHours() + 1); // Default to one hour from now
Â  Â  Â  Â  Â  Â  Â  Â  eventDateInput.value = tomorrow.toISOString().slice(0, 16);
Â  Â  Â  Â  Â  Â  Â  Â  currentEditingEventId = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Closes a given modal.
Â  Â  Â  Â  Â * @param {HTMLElement} modalElement - The modal element to close.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function closeModal(modalElement) {
Â  Â  Â  Â  Â  Â  const modalContent = modalElement.querySelector('.modal-content');
Â  Â  Â  Â  Â  Â  modalContent.classList.remove('translate-y-0', 'opacity-100');
Â  Â  Â  Â  Â  Â  modalContent.classList.add('-translate-y-10', 'opacity-0');
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  modalElement.classList.add('hidden');
Â  Â  Â  Â  Â  Â  }, 300); // Match transition duration
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Handles the submission of the event form (add or edit).
Â  Â  Â  Â  Â * @param {Event} e - The form submission event.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function handleEventFormSubmit(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  const title = eventTitleInput.value.trim();
Â  Â  Â  Â  Â  Â  const date = eventDateInput.value;
Â  Â  Â  Â  Â  Â  const icon = eventIconInput.value.trim();
Â  Â  Â  Â  Â  Â  const isRecurring = eventRecurringCheckbox.checked;

Â  Â  Â  Â  Â  Â  if (!title || !date) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Please fill in all required fields.', 'alert');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const newEventData = {
Â  Â  Â  Â  Â  Â  Â  Â  id: currentEditingEventId || Date.now().toString(), // Use existing ID or generate new
Â  Â  Â  Â  Â  Â  Â  Â  title: title,
Â  Â  Â  Â  Â  Â  Â  Â  targetDate: date,
Â  Â  Â  Â  Â  Â  Â  Â  icon: icon,
Â  Â  Â  Â  Â  Â  Â  Â  isRecurring: isRecurring,
Â  Â  Â  Â  Â  Â  Â  Â  // Store initial remaining time for progress bar calculation
Â  Â  Â  Â  Â  Â  Â  Â  initialRemaining: currentEditingEventId ? events.find(e => e.id === currentEditingEventId)?.initialRemaining : (new Date(date).getTime() - new Date().getTime())
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  if (currentEditingEventId) {
Â  Â  Â  Â  Â  Â  Â  Â  // Editing existing event
Â  Â  Â  Â  Â  Â  Â  Â  const index = events.findIndex(e => e.id === currentEditingEventId);
Â  Â  Â  Â  Â  Â  Â  Â  if (index !== -1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  events[index] = newEventData;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Adding new event
Â  Â  Â  Â  Â  Â  Â  Â  events.push(newEventData);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  saveEvents();
Â  Â  Â  Â  Â  Â  sortEvents(); // Re-sort after adding/editing
Â  Â  Â  Â  Â  Â  closeModal(addEditModal);
Â  Â  Â  Â  Â  Â  showMessageBox('Event saved successfully!', 'alert');
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Deletes an event by its ID.
Â  Â  Â  Â  Â * @param {string} id - The ID of the event to delete.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function deleteEvent(id) {
Â  Â  Â  Â  Â  Â  events = events.filter(event => event.id !== id);
Â  Â  Â  Â  Â  Â  saveEvents();
Â  Â  Â  Â  Â  Â  renderCountdowns();
Â  Â  Â  Â  Â  Â  showMessageBox('Event deleted successfully!', 'alert');
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Sets the initial theme based on localStorage or system preference.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function setInitialTheme() {
Â  Â  Â  Â  Â  Â  const savedTheme = localStorage.getItem('eventEaseTheme');
Â  Â  Â  Â  Â  Â  if (savedTheme) {
Â  Â  Â  Â  Â  Â  Â  Â  htmlElement.className = savedTheme;
Â  Â  Â  Â  Â  Â  } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
Â  Â  Â  Â  Â  Â  Â  Â  htmlElement.className = 'dark';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  htmlElement.className = 'light';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  settingsThemeToggle.checked = htmlElement.classList.contains('dark');
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Toggles between light and dark mode.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function toggleTheme() {
Â  Â  Â  Â  Â  Â  if (htmlElement.classList.contains('light')) {
Â  Â  Â  Â  Â  Â  Â  Â  htmlElement.classList.remove('light');
Â  Â  Â  Â  Â  Â  Â  Â  htmlElement.classList.add('dark');
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('eventEaseTheme', 'dark');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  htmlElement.classList.remove('dark');
Â  Â  Â  Â  Â  Â  Â  Â  htmlElement.classList.add('light');
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('eventEaseTheme', 'light');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  settingsThemeToggle.checked = htmlElement.classList.contains('dark');
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Populates and displays the emoji picker modal.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function showEmojiPicker() {
Â  Â  Â  Â  Â  Â  emojiGrid.innerHTML = '';
Â  Â  Â  Â  Â  Â  commonEmojis.forEach(emoji => {
Â  Â  Â  Â  Â  Â  Â  Â  const span = document.createElement('span');
Â  Â  Â  Â  Â  Â  Â  Â  span.textContent = emoji;
Â  Â  Â  Â  Â  Â  Â  Â  span.className = 'cursor-pointer p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md transition-colors';
Â  Â  Â  Â  Â  Â  Â  Â  span.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventIconInput.value = emoji;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeModal(emojiPickerModal);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  emojiGrid.appendChild(span);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  openModal(emojiPickerModal); // Use helper function for consistent modal opening
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Clears all countdown data from localStorage.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function clearAllData() {
Â  Â  Â  Â  Â  Â  showMessageBox('Are you sure you want to clear ALL countdowns? This cannot be undone.', 'confirm', () => {
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('eventEaseEvents');
Â  Â  Â  Â  Â  Â  Â  Â  events = [];
Â  Â  Â  Â  Â  Â  Â  Â  renderCountdowns();
Â  Â  Â  Â  Â  Â  Â  Â  closeModal(settingsModal);
Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('All countdowns cleared!', 'alert');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Exports countdown data as a JSON file.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function exportData() {
Â  Â  Â  Â  Â  Â  const dataStr = JSON.stringify(events, null, 2);
Â  Â  Â  Â  Â  Â  const blob = new Blob([dataStr], { type: 'application/json' });
Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  Â  Â  a.download = `eventease_countdowns_${new Date().toISOString().slice(0, 10)}.json`;
Â  Â  Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  Â  Â  a.click();
Â  Â  Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  Â  Â  Â  Â  showMessageBox('Countdowns exported successfully!', 'alert');
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Imports countdown data from a JSON file.
Â  Â  Â  Â  Â * @param {Event} e - The file input change event.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function importData(e) {
Â  Â  Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  Â  Â  if (!file) return;

Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  reader.onload = (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const importedEvents = JSON.parse(event.target.result);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Array.isArray(importedEvents)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Replace existing countdowns with imported data?', 'confirm', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  events = importedEvents.map(ev => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: ev.id || Date.now().toString() + Math.random().toString(36).substring(2, 9), // Ensure unique ID
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: ev.title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetDate: ev.targetDate,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: ev.icon || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isRecurring: ev.isRecurring || false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  initialRemaining: ev.initialRemaining || (new Date(ev.targetDate).getTime() - new Date().getTime()) // Preserve or set initialRemaining
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveEvents();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sortEvents();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeModal(settingsModal);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Countdowns imported successfully!', 'alert');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Invalid JSON format. Please select a valid EventEase export file.', 'alert');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Error parsing JSON file. Please ensure it is a valid JSON.', 'alert');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error importing data:", error);
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.value = ''; // Clear the file input
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  reader.readAsText(file);
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Displays a custom message box.
Â  Â  Â  Â  Â * @param {string} message - The message to display.
Â  Â  Â  Â  Â * @param {'alert'|'confirm'} type - Type of message box (alert or confirmation).
Â  Â  Â  Â  Â * @param {function} [onConfirm] - Callback function for 'confirm' type when OK is clicked.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function showMessageBox(message, type = 'alert', onConfirm = null) {
Â  Â  Â  Â  Â  Â  const messageBoxText = document.getElementById('message-box-text');
Â  Â  Â  Â  Â  Â  const messageBoxOkBtn = document.getElementById('message-box-ok');
Â  Â  Â  Â  Â  Â  const messageBoxCancelBtn = document.getElementById('message-box-cancel');

Â  Â  Â  Â  Â  Â  messageBoxText.textContent = message;

Â  Â  Â  Â  Â  Â  messageBoxOkBtn.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  closeModal(messageBoxModal);
Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'confirm' && onConfirm) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onConfirm();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  if (type === 'confirm') {
Â  Â  Â  Â  Â  Â  Â  Â  messageBoxCancelBtn.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  messageBoxCancelBtn.onclick = () => closeModal(messageBoxModal);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  messageBoxCancelBtn.classList.add('hidden');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  openModal(messageBoxModal); // Use helper function for consistent modal opening
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Triggers a simple confetti animation.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function triggerConfetti() {
Â  Â  Â  Â  Â  Â  confettiContainer.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
Â  Â  Â  Â  Â  Â  for (let i = 0; i < 50; i++) { // Generate 50 confetti pieces
Â  Â  Â  Â  Â  Â  Â  Â  const confetti = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  confetti.className = 'confetti';
Â  Â  Â  Â  Â  Â  Â  Â  confetti.style.left = `${Math.random() * 100}vw`;
Â  Â  Â  Â  Â  Â  Â  Â  confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
Â  Â  Â  Â  Â  Â  Â  Â  confetti.style.animationDelay = `${Math.random() * 0.5}s`;
Â  Â  Â  Â  Â  Â  Â  Â  confetti.style.animationDuration = `${2 + Math.random() * 2}s`; // 2 to 4 seconds
Â  Â  Â  Â  Â  Â  Â  Â  confetti.style.transform = `translateY(${Math.random() * -100}px) rotate(${Math.random() * 360}deg)`; // Start slightly above
Â  Â  Â  Â  Â  Â  Â  Â  confettiContainer.appendChild(confetti);

Â  Â  Â  Â  Â  Â  Â  Â  // Remove confetti after animation to prevent DOM bloat
Â  Â  Â  Â  Â  Â  Â  Â  confetti.addEventListener('animationend', () => confetti.remove());
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // Hide container after a short while if no new confetti is generated
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if (confettiContainer.children.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confettiContainer.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 4000);
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Initializes Google Sign-In button.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function initializeGoogleSignIn() {
Â  Â  Â  Â  Â  Â  // IMPORTANT: Replace with your actual Google Client ID
Â  Â  Â  Â  Â  Â  const GOOGLE_CLIENT_ID = "1039311902277-tvpr8aubdmi2o4hbqgmff7ohnccgisqa.apps.googleusercontent.com";

Â  Â  Â  Â  Â  Â  if (GOOGLE_CLIENT_ID === "YOUR_GOOGLE_CLIENT_ID") {
Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Google Client ID is not set. Please replace 'YOUR_GOOGLE_CLIENT_ID' in the script.");
Â  Â  Â  Â  Â  Â  Â  Â  const signInBtnContainer = document.getElementById('google-signin-btn');
Â  Â  Â  Â  Â  Â  Â  Â  if(signInBtnContainer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  signInBtnContainer.innerHTML = '<p class="text-xs text-red-500">Google Client ID not configured.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  google.accounts.id.initialize({
Â  Â  Â  Â  Â  Â  Â  Â  client_id: GOOGLE_CLIENT_ID,
Â  Â  Â  Â  Â  Â  Â  Â  callback: handleCredentialResponse
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  google.accounts.id.renderButton(
Â  Â  Â  Â  Â  Â  Â  Â  googleSignInBtn,
Â  Â  Â  Â  Â  Â  Â  Â  { theme: "outline", size: "large", type: 'icon', shape: 'circle' } // Customize button
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  // google.accounts.id.prompt(); // Optional: show One Tap prompt
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Handles the response from Google Sign-In.
Â  Â  Â  Â  Â * @param {object} response - The credential response object from Google.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function handleCredentialResponse(response) {
Â  Â  Â  Â  Â  Â  // Decode the JWT token to get user profile information
Â  Â  Â  Â  Â  Â  const credential = response.credential;
Â  Â  Â  Â  Â  Â  const payload = JSON.parse(atob(credential.split('.')[1]));

Â  Â  Â  Â  Â  Â  // Update UI with user info
Â  Â  Â  Â  Â  Â  userAvatarImg.src = payload.picture;
Â  Â  Â  Â  Â  Â  userAvatarImg.alt = `${payload.name}'s avatar`;
Â  Â  Â  Â  Â  Â  userProfileDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  userProfileDiv.classList.add('flex');
Â  Â  Â  Â  Â  Â  googleSignInBtn.style.display = 'none';

Â  Â  Â  Â  Â  Â  showMessageBox(`Welcome, ${payload.given_name}!`, 'alert');
Â  Â  Â  Â  Â  Â  // Here you could potentially namespace localStorage or fetch data from a backend
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Handles user sign-out.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function handleSignOut() {
Â  Â  Â  Â  Â  Â  // This is a simplified sign-out. For a full sign-out, you might need to
Â  Â  Â  Â  Â  Â  // call google.accounts.id.disableAutoSelect() or manage server-side sessions.
Â  Â  Â  Â  Â  Â  userProfileDiv.classList.add('hidden');
Â  Â  Â  Â  Â  Â  userProfileDiv.classList.remove('flex');
Â  Â  Â  Â  Â  Â  googleSignInBtn.style.display = 'block';

Â  Â  Â  Â  Â  Â  // It's good practice to re-initialize or at least re-render the button
Â  Â  Â  Â  Â  Â  // in case the user wants to sign in again.
Â  Â  Â  Â  Â  Â  // Note: The google object might not be available if the script failed to load.
Â  Â  Â  Â  Â  Â  if (window.google && google.accounts && google.accounts.id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â google.accounts.id.renderButton(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  googleSignInBtn,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { theme: "outline", size: "large", type: 'icon', shape: 'circle' }
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  showMessageBox('You have been signed out.', 'alert');
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Attaches all global event listeners.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function attachEventListeners() {
Â  Â  Â  Â  Â  Â  // Header buttons
Â  Â  Â  Â  Â  Â  themeToggleBtn.addEventListener('click', toggleTheme);
Â  Â  Â  Â  Â  Â  settingsBtn.addEventListener('click', () => openModal(settingsModal));
Â  Â  Â  Â  Â  Â  signOutBtn.addEventListener('click', handleSignOut);

Â  Â  Â  Â  Â  Â  // Initial CTA button
Â  Â  Â  Â  Â  Â  createFirstCountdownBtn.addEventListener('click', () => openAddEditModal());

Â  Â  Â  Â  Â  Â  // FAB
Â  Â  Â  Â  Â  Â  addEventFab.addEventListener('click', () => openAddEditModal());

Â  Â  Â  Â  Â  Â  // Add/Edit Modal buttons
Â  Â  Â  Â  Â  Â  cancelAddEditBtn.addEventListener('click', () => closeModal(addEditModal));
Â  Â  Â  Â  Â  Â  eventForm.addEventListener('submit', handleEventFormSubmit);
Â  Â  Â  Â  Â  Â  openEmojiPickerBtn.addEventListener('click', showEmojiPicker);

Â  Â  Â  Â  Â  Â  // Settings Modal buttons
Â  Â  Â  Â  Â  Â  closeSettingsBtn.addEventListener('click', () => closeModal(settingsModal));
Â  Â  Â  Â  Â  Â  settingsThemeToggle.addEventListener('change', toggleTheme);
Â  Â  Â  Â  Â  Â  exportDataBtn.addEventListener('click', exportData);
Â  Â  Â  Â  Â  Â  importFileInput.addEventListener('change', importData);
Â  Â  Â  Â  Â  Â  clearAllDataBtn.addEventListener('click', clearAllData);
Â  Â  Â  Â  Â  Â  sortBySelect.addEventListener('change', sortEvents);

Â  Â  Â  Â  Â  Â  // Emoji Picker Modal buttons
Â  Â  Â  Â  Â  Â  closeEmojiPickerModalBtn.addEventListener('click', () => closeModal(emojiPickerModal));

Â  Â  Â  Â  Â  Â  // Close modals when clicking outside (on overlay)
Â  Â  Â  Â  Â  Â  addEditModal.addEventListener('click', (e) => { if (e.target === addEditModal) closeModal(addEditModal); });
Â  Â  Â  Â  Â  Â  settingsModal.addEventListener('click', (e) => { if (e.target === settingsModal) closeModal(settingsModal); });
Â  Â  Â  Â  Â  Â  emojiPickerModal.addEventListener('click', (e) => { if (e.target === emojiPickerModal) closeModal(emojiPickerModal); });
Â  Â  Â  Â  Â  Â  messageBoxModal.addEventListener('click', (e) => { if (e.target === messageBoxModal) closeModal(messageBoxModal); });
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Helper to open any modal with transition.
Â  Â  Â  Â  Â * @param {HTMLElement} modalElement - The modal element to open.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function openModal(modalElement) {
Â  Â  Â  Â  Â  Â  modalElement.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  const modalContent = modalElement.querySelector('.modal-content');
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  modalContent.classList.remove('-translate-y-10', 'opacity-0');
Â  Â  Â  Â  Â  Â  Â  Â  modalContent.classList.add('translate-y-0', 'opacity-100');
Â  Â  Â  Â  Â  Â  }, 10);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Initialize the app when the window is fully loaded to ensure Google script is ready
Â  Â  Â  Â  window.onload = initApp;
Â  Â  </script>
</body>
</html>
